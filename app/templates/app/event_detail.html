{% extends "base.html" %}
{% load static %}
{% load tz %}

{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<style>
  .card {
  background-color: transparent;
  border: none;
  color: #fff;
}


  .event-card .ratio > img { object-fit: cover; }
  .event-card:hover { transform: translateY(-3px); transition: transform .2s ease; }
  .line-clamp-2 {
    display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
  }

  body{
    background: url("{% static 'images/foto_home.jpeg' %}") center/cover fixed no-repeat;
  }
  .eventos-section .overlay{
    background: rgba(0,0,0,0.55);
    min-height: 100vh;
    padding: 2rem;
  }

  .event-title { margin-bottom: .25rem; }
  .price { font-weight: 600; }
</style>

<div class="eventos-section">
  <div class="overlay">
    <div class="container">
      <div class="row justify-content-center g-4">
        <div class="col-12 col-lg-10">
          <div class="card shadow-sm event-card">
            <div class="row g-0">
              <div class="col-12 col-md-6">
                <div class="ratio ratio-4x3">
                  <img
                    src="{% if event.image %}{{ event.image.url }}{% else %}{% static 'img/event-placeholder.jpg' %}{% endif %}"
                    alt="Imagen del evento {{ event.title }}"
                    class="w-100 h-100"
                    loading="lazy"
                  />
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="card-body h-100 d-flex flex-column">
                  <h4 class="event-title">{{ event.title }}</h4>

                  <div class="small text-white mb-1">
                    {{ event.date|date:"d/m/Y H:i" }}
                  </div>
                  <div class="small mb-2">
                    {{ event.venue.name }}
                  </div>

                  <div class="mb-2">
                    <span class="badge bg-light text-dark">{{ event.category.name }}</span>
                  </div>

                  <div class="price mb-3">
                    {% if event.prize and event.prize > 0 %}
                      ${{ event.prize|floatformat:2 }}
                    {% else %}
                      Entrada libre
                    {% endif %}
                  </div>

                  <p class="mb-4">{{ event.description }}</p>

                  <div class="mt-auto">
                    <form action="{% url 'comprar_ticket' event.id %}" method="post" class="d-grid">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-primary">
                        Comprar
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row justify-content-center g-4 mt-1">
        <div class="col-12 col-lg-10">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="mb-3">Comentarios</h5>
              {% for comment in comments %}
                <div class="border rounded p-3 mb-3">
                  <strong>{{ comment.user.username }}</strong>
                  <small class="text-white"> · {{ comment.created_at|date:"d/m/Y H:i" }}</small>
                  {% if comment.title %}<h6 class="mt-2">{{ comment.title }}</h6>{% endif %}
                  <p class="mb-0">{{ comment.text }}</p>
                </div>
              {% empty %}
                <p>No hay comentarios aún.</p>
              {% endfor %}
            </div>
          </div>

          <div class="card shadow-sm mt-3">
            <div class="card-body">
              <h5 class="mb-3">Dejá tu comentario</h5>
              <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                  <label for="title" class="form-label">Título</label>
                  <input type="text" name="title" id="title" class="form-control" required>
                  {% if errors.title %}<div class="text-danger">{{ errors.title }}</div>{% endif %}
                </div>
                <div class="mb-3">
                  <label for="text" class="form-label">Comentario</label>
                  <textarea name="text" id="text" class="form-control" rows="4" required></textarea>
                  {% if errors.text %}<div class="text-danger">{{ errors.text }}</div>{% endif %}
                </div>
                <button type="submit" class="btn btn-success">Enviar comentario</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr class="my-4">
</div>
{% endblock %}
